<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notes — Obsidian-ish (Read-Only)</title>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <style>
    :root{
      --bg:#0f1115; --panel:#161a22; --muted:#8b90a1; --fg:#e6e9ef; --accent:#7aa2f7; --outline:#2a3140; --code-bg:#0b0d12;
      --shadow: 0 8px 30px rgba(0,0,0,.35); --radius: 16px; --content-w: 860px;
    }
    html.light{ --bg:#f7f8fb; --panel:#ffffff; --muted:#5a6475; --fg:#10121a; --accent:#1d4ed8; --outline:#e8eaf1; --code-bg:#f2f4f8; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;max-width:1400px;margin:auto;padding:16px}
    @media (max-width: 1024px){.wrap{grid-template-columns:1fr}}

    /* Sidebar */
    .side{background:var(--panel);border:1px solid var(--outline);border-radius:var(--radius);padding:14px;position:sticky;top:12px;height:calc(100dvh - 24px);overflow:auto;box-shadow:var(--shadow)}
    .side h2{margin:2px 0 10px 0;font-size:13px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;margin:6px 0}
    .btn{appearance:none;border:1px solid var(--outline);background:transparent;color:var(--fg);padding:8px 10px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:var(--accent)}
    .chip{font-size:12px;border:1px solid var(--outline);padding:4px 8px;border-radius:999px;color:var(--muted)}
    #meta{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}

    /* Content */
    .content{background:var(--panel);border:1px solid var(--outline);border-radius:var(--radius);box-shadow:var(--shadow);padding:8px}
    .note{max-width:var(--content-w);margin:auto;padding:24px}

    /* Markdown */
    .note h1,.note h2,.note h3,.note h4,.note h5{line-height:1.25}
    .note h1{font-size:2rem;margin:0 0 1rem;}
    .note h2{font-size:1.5rem;margin:1.5rem 0 .75rem;border-bottom:1px solid var(--outline);padding-bottom:.35rem}
    .note h3{font-size:1.25rem;margin:1.25rem 0 .5rem}
    .note p{margin:.7rem 0}
    .note blockquote{margin:.9rem 0;padding:.6rem .9rem;border-left:3px solid var(--outline);background:rgba(255,255,255,.02);border-radius:8px}
    .note code{background:var(--code-bg);padding:.15em .4em;border-radius:6px;border:1px solid var(--outline);font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:.95em}
    .note pre{background:var(--code-bg);border:1px solid var(--outline);border-radius:12px;overflow:auto;padding:14px}
    .note pre code{border:none;padding:0;background:transparent}
    .note table{border-collapse:collapse;width:100%;margin:1rem 0}
    .note th,.note td{border:1px solid var(--outline);padding:.5rem;text-align:left}
    .note hr{border:none;border-top:1px solid var(--outline);margin:1.5rem 0}
    .note img{max-width:100%;border-radius:12px;border:1px solid var(--outline)}

    /* TOC & scrollspy */
    #toc{font-size:14px}
    #toc a{display:block;padding:6px 8px;border-radius:8px;color:var(--muted)}
    #toc a:hover{background:var(--bg);color:var(--fg)}
    #toc a.active{background:var(--bg);color:var(--fg);border-left:3px solid var(--accent)}
    #toc .d2{padding-left:12px}
    #toc .d3{padding-left:24px}

    /* Heading anchors */
    .anchor-link{opacity:0; margin-left:.3em; font-size:.9em}
    h1:hover .anchor-link, h2:hover .anchor-link, h3:hover .anchor-link{opacity:.9}

    /* Top bar */
    .topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px}
    .title{font-weight:600;color:var(--muted);letter-spacing:.02em}

    /* Print */
    @media print{
      html.light:root, html:root{ --bg:#fff; --panel:#fff; --fg:#000; --outline:#ddd; }
      .side{display:none}
      .wrap{grid-template-columns:1fr}
      .content{box-shadow:none;border:none}
    }

    /* MathJax tweaks */
    .note mjx-container[jax="SVG"] { line-height: 0; }
    .note mjx-container { margin: .6em 0; }
  </style>

  <!-- MathJax for LaTeX math rendering -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        tags: 'ams',
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script','noscript','style','textarea','pre','code'],
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>
</head>
<body>
  <div class="wrap">
    <aside class="side">
      <div class="topbar">
        <div class="title">Markdown Note</div>
        <span class="chip" id="status">Ready</span>
      </div>
      <h2>Options</h2>
      <div class="row">
        <button class="btn" id="themeBtn">Toggle Theme</button>
      </div>
      <div id="meta"></div>
      <h2>Contents</h2>
      <nav id="toc" aria-label="Table of contents"></nav>
    </aside>

    <main class="content">
      <article id="note" class="note" aria-live="polite"></article>
    </main>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/marked@12.0.2/marked.min.js"></script>
  <script src="https://unpkg.com/dompurify@3.1.7/dist/purify.min.js"></script>
  <script src="https://unpkg.com/highlight.js@11.9.0/lib/common.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/highlight.js@11.9.0/styles/github-dark-dimmed.min.css">

  <script>
    // ===== 1) PASTE YOUR MARKDOWN BETWEEN <<<MD and MD  >>> =====
    // Frontmatter (YAML) supported at the top. Example:
    // ---
    // title: My Note
    // date: 2025-10-05
    // tags: [game-dev, design]
    // ---
    const MARKDOWN = String.raw`
---
title: Example with Math
date: 2025-10-05
tags: [notes, math]
---

# Sustainable Criticality

We want a matching function $M(C,S)$ such that

$$
M(C,S) = \begin{cases}
\text{sustainable criticality} & \text{if } S \ge f(C)\\\\
\text{oscillation or collapse} & \text{if } S < f(C)
\end{cases}
$$

where $f(C)$ is monotonically increasing.

```js
// code remains unaffected by math rendering
console.log('no math here $E=mc^2$');
```
`;
    // ===== End paste area =====

    // Theme persistence
    const savedTheme = localStorage.getItem('theme');
    const prefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
    if(savedTheme){ document.documentElement.classList.toggle('light', savedTheme === 'light'); }
    else if(prefersLight){ document.documentElement.classList.add('light'); }

    document.getElementById('themeBtn').addEventListener('click', () => {
      document.documentElement.classList.toggle('light');
      localStorage.setItem('theme', document.documentElement.classList.contains('light') ? 'light' : 'dark');
    });

    // Marked configuration
    marked.setOptions({ gfm: true, breaks: false, highlight: (code, lang) => { try { return hljs.highlight(code, {language: lang}).value } catch { return hljs.highlightAuto(code).value } } });

    // Parse frontmatter (very small YAML-ish parser for simple cases)
    function parseFrontmatter(src){
      const fmMatch = src.match(/^---\n([\s\S]*?)\n---\n?/);
      if(!fmMatch) return { meta: {}, body: src };
      const yaml = fmMatch[1];
      const body = src.slice(fmMatch[0].length);
      const meta = {};
      yaml.split(/\n/).forEach(line => {
        const m = line.match(/^([A-Za-z0-9_-]+):\s*(.*)$/);
        if(!m) return;
        const key = m[1];
        let val = m[2].trim();
        // parse arrays like [a, b]
        if(/^\[.*\]$/.test(val)){
          val = val.slice(1, -1).split(',').map(s => s.trim()).filter(Boolean);
        } else if(/^\d{4}-\d{2}-\d{2}$/.test(val)){
          // date string
        } else {
          val = val.replace(/^"|"$/g,'').replace(/^'|'$/g,'');
        }
        meta[key] = val;
      });
      return { meta, body };
    }

    function addHeadingAnchors(container){
      container.querySelectorAll('h1, h2, h3').forEach(h => {
        if(!h.id){ h.id = h.textContent.trim().toLowerCase().replace(/[^a-z0-9]+/g,'-'); }
        const a = document.createElement('a');
        a.href = '#' + h.id; a.textContent = '¶'; a.className = 'anchor-link'; a.title = 'Copy link';
        a.addEventListener('click', (e) => {
          e.preventDefault();
          const url = location.origin + location.pathname + '#' + h.id;
          navigator.clipboard.writeText(url).then(()=>{ statusFlash('Link copied'); });
          history.replaceState(null, '', '#' + h.id);
        });
        h.appendChild(a);
      });
    }

    function buildTOC(){
      const tocEl = document.getElementById('toc');
      tocEl.innerHTML = '';
      const hs = document.querySelectorAll('#note h1, #note h2, #note h3');
      hs.forEach(h => {
        const a = document.createElement('a');
        a.href = '#' + h.id;
        a.textContent = h.textContent.replace(/¶$/, '').trim();
        a.className = h.tagName === 'H1' ? 'd1' : h.tagName === 'H2' ? 'd2' : 'd3';
        tocEl.appendChild(a);
      });

      // Scrollspy
      const links = [...tocEl.querySelectorAll('a')];
      const obs = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            links.forEach(l=>l.classList.toggle('active', l.getAttribute('href') === '#' + e.target.id));
          }
        });
      }, { rootMargin: '-40% 0px -55% 0px', threshold: [0,1] });
      document.querySelectorAll('#note h1, #note h2, #note h3').forEach(h => obs.observe(h));
    }

    function statusFlash(msg){
      const s = document.getElementById('status');
      const prev = s.textContent;
      s.textContent = msg;
      setTimeout(()=> s.textContent = prev, 900);
    }

    // Render
    (function render(){
      const { meta, body } = parseFrontmatter(MARKDOWN.trim());
      if(meta.title) document.title = meta.title + ' — Notes';
      const metaBox = document.getElementById('meta');
      metaBox.innerHTML = '';
      if(meta.title){ const t = document.createElement('div'); t.className='chip'; t.textContent = 'Title: ' + meta.title; metaBox.appendChild(t); }
      if(meta.date){ const d = document.createElement('div'); d.className='chip'; d.textContent = 'Date: ' + meta.date; metaBox.appendChild(d); }
      if(meta.updated){ const u = document.createElement('div'); u.className='chip'; u.textContent = 'Updated: ' + meta.updated; metaBox.appendChild(u); }
      if(Array.isArray(meta.tags)){
        meta.tags.forEach(tag=>{ const c=document.createElement('div'); c.className='chip'; c.textContent='#'+tag; metaBox.appendChild(c); });
      }

      const html = marked.parse(body);
      const safe = DOMPurify.sanitize(html, {USE_PROFILES: {html: true}});
      const noteEl = document.getElementById('note');
      noteEl.innerHTML = safe;

      // Typeset math (MathJax)
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([noteEl]).catch(() => {});
      }

      // Syntax highlight after math
      document.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
      addHeadingAnchors(noteEl);
      buildTOC();

      // Jump to hash on load
      if(location.hash){ const target = document.getElementById(location.hash.slice(1)); if(target){ target.scrollIntoView(); } }
    })();

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const meta = e.metaKey || e.ctrlKey;
      // Ctrl/Cmd + Shift + T : toggle theme
      if(meta && e.shiftKey && (e.key === 'T' || e.key === 't')){ e.preventDefault(); document.getElementById('themeBtn').click(); }
      // Ctrl/Cmd + \ : focus TOC
      if(meta && e.key === '\\'){ e.preventDefault(); document.getElementById('toc')?.querySelector('a')?.focus(); }
    });
  </script>
</body>
</html>
